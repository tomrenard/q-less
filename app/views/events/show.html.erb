<main>

  <div class=img-container>
    <% if @event.photo.attached? %>
    <div class=show-img><%= cl_image_tag @event.photo.key, height: 300, width: 400, crop: :fit %></div>
      <% else %>
      <div class=show-img><img src="<%= @event.photo_link %>" alt=""></div>
    <% end %>
  </div>

  <div>

    <div>
      <h1><%= @event.title %></h1>
      <h3><%= @event.category %></h3>
      <h3><%= @event.location %></h3>
      <p><%= @event.address %></p>
      <p>Line up: <%= @event.line_up %></p>
      <p><%= @event.description %></p>
      <h3><%= @event.price %></h3>
      <h3><%= @event.start_time %></h3>
      <h3><%= @event.end_time %></h3>
      <h3><%= @event.tag_list %></h3>
      <h5>The average waiting time is 17min.</h5>
      <ul><% @related_events.each do |event| %>
        <li><%= event.title %>
        <% end %>
      </ul>
    </div>

    <div>
      <%= simple_form_for [@event, @event_wishlist] do |f| %>
      <%= f.submit "<3"%>
      <% end %>
    </div>

     <%= link_to new_event_queue_estimation_path(@event, @queue_estimation) do %>
      <button class="book-btn btn btn-flat">Give a estimation of the queue</button>
      <% end %>

    <% if policy(Event).destroy? %>
        <p><%= link_to "Delete my event", event_path(@event), method: :delete, data: { confirm: "Are you sure?"}, class: 'btn btn-danger'%></p>
    <% end %>
    <% if policy(Event).edit? %>
        <p><%= link_to "Update my event", edit_event_path(@event), class: 'btn btn-info'%></p>
    <% end %>

  </div>
</main>

<% if @chatroom.nil? %>
  <p>No chatroom for now.</p>
<% else %>
  <h1>#<%= @chatroom.name %></h1>
  <div id="messages" data-chatroom-id="<%= @chatroom.id %>">
  <% @chatroom.messages.each do |message| %>
    <div class="message-container" id="message-<%= message.id %>">
      <i class="author">
        <span><%= message.user.nickname %></span>
        <small><%= message.created_at.strftime("%a %b %e at %l:%M%p") %></small>
      </i>
      <p><%= message.content %></p>
    </div>
    <%= simple_form_for [ @chatroom, @message ], remote: true do |f| %>
  <%= f.input :content, label: false, placeholder: "Message ##{@chatroom.name}" %>
  <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
<% end %>
  </div>
  <% end %>

<% end %>


